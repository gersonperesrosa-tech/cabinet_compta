{% extends "base.html" %}

{% block content %}

<section class="section">

<div class="container py-4">

    <!-- En-tête -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Mes notes personnelles</h2>

        <div class="d-flex gap-2">
            <a href="{% url 'user_space' %}" class="btn btn-outline-secondary">
                ← Retour au tableau de bord
            </a>
            <a href="{% url 'add_user_note' %}" class="btn btn-primary">
                + Nouvelle note
            </a>
        </div>
    </div>

<!-- Barre de recherche instantanée -->
<div class="card p-3 mb-4">
    <input type="text"
           id="note-search"
           class="form-control"
           placeholder="Rechercher une note...">
</div>
</div>

<!-- Liste des notes -->
{% if notes %}
    <div class="list-group" id="notes-list">

        {% for note in notes %}
            <div class="list-group-item note-item">

                <div class="d-flex justify-content-between">
                    <div>
                        <div class="fw-bold note-title">{{ note.titre|default:"Sans titre" }}</div>
                        <div class="text-muted small">{{ note.created_at|date:"d/m/Y H:i" }}</div>

                        {% if note.categorie %}
                            <span class="badge bg-secondary mt-1">{{ note.categorie.nom }}</span>
                        {% endif %}
                    </div>

                    <div class="text-end">
                        <a href="{% url 'edit_user_note' note.id %}" class="btn btn-sm btn-outline-secondary">
                            Modifier
                        </a>
                        <a href="{% url 'delete_user_note' note.id %}" class="btn btn-sm btn-outline-danger">
                            Supprimer
                        </a>
                    </div>
                </div>

                <div class="mt-2 note-content">
                    {{ note.contenu|truncatechars:200 }}
                </div>

            </div>
        {% endfor %}

    </div>

{% else %}
    <p class="text-muted"><em>Aucune note ne correspond à votre recherche…</em></p>
{% endif %}

</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const searchInput = document.getElementById("note-search");
    const notesList = document.getElementById("notes-list");
    if (!searchInput || !notesList) return;

    const items = notesList.getElementsByClassName("note-item");

    searchInput.addEventListener("keyup", function () {
        const query = this.value.toLowerCase().trim();

        for (let i = 0; i < items.length; i++) {
            const item = items[i];

            const title = item.querySelector(".note-title")?.textContent.toLowerCase() || "";
            const content = item.querySelector(".note-content")?.textContent.toLowerCase() || "";

            const text = title + " " + content;

            if (text.includes(query)) {
                item.style.display = "";
            } else {
                item.style.display = "none";
            }
        }
    });
});
</script>


{% endblock %}
