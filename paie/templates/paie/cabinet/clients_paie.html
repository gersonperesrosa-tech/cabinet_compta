{% extends "base.html" %}

{% block content %}
<section class="section">

<div class="container mt-4">

    <h1 class="mb-4">Clients avec module paie activé</h1>

    {% if clients %}
        <table class="table table-hover align-middle">
            <thead>
                <tr>
                    <th>Client</th>
                    <th>Forme juridique</th>
                    <th>Salariés actifs</th>
                    <th>Dernier mois traité</th>
                    <th class="text-center">Actions</th>
                </tr>
            </thead>

<tbody>
    {% for c in clients %}
    <tr>
        <td>{{ c.nom }}</td>
        <td>{{ c.forme_juridique }}</td>

        <td>
            <span class="badge bg-primary">
                {{ c.nb_salaries_actifs }}
            </span>
        </td>

 <td>
    {% if c.dernier_mois_traite %}
        <div class="d-flex align-items-center gap-2">

            <!-- Mois traité -->
                {{ c.dernier_mois_traite.mois }}/{{ c.dernier_mois_traite.annee }}

            <!-- BS -->
            {% if c.dernier_mois_traite.bs_fait %}
                <span class="badge bg-success">BS</span>
            {% else %}
                <span class="badge bg-secondary">BS</span>
            {% endif %}

            <!-- DSN -->
            {% if c.dernier_mois_traite.dsn_faite %}
                <span class="badge bg-primary">DSN</span>
            {% else %}
                <span class="badge bg-secondary">DSN</span>
            {% endif %}

        </div>
    {% else %}
        <span class="text-muted">—</span>
    {% endif %}
</td>


        <td class="text-center d-flex justify-content-end gap-2">

            <a href="{% url 'paie:cabinet_liste_salaries_client' c.id %}"
               class="btn btn-sm btn-outline-primary">
                Voir salariés
            </a>

            {% if c.paiemois_set.exists %}
                <a href="{% url 'paie:liste_mois_client' c.id %}"
                   class="btn btn-sm btn-outline-primary">
                    Mois de paie
                </a>
            {% else %}
                <a href="{% url 'paie:cabinet_creer_mois_paie' c.id %}"
                   class="btn btn-sm btn-outline-primary">
                    + Créer mois de paie
                </a>
            {% endif %}

        </td>
    </tr>
    {% endfor %}
</tbody>
        </table>

    {% else %}
        <p class="text-muted">Aucun client n’a activé le module Paie.</p>
    {% endif %}

</div>
{% endblock %}
