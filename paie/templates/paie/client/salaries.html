{% extends "base_paie_client.html" %}

{% block title %}Salariés{% endblock %}

{% block content %}
<section class="section">

<div class="d-flex justify-content-between align-items-center mb-4">

    <!-- Titre -->
    <h1 class="m-0">Liste des salariés</h1>

    <!-- Barre de recherche + filtres -->
    <div class="d-flex align-items-center gap-3 flex-grow-1 justify-content-center">

        <!-- Barre de recherche -->
        <input type="text" id="searchInput" class="form-control w-50"
               placeholder="Rechercher un salarié...">

        <!-- Boutons filtre -->
        <div class="d-flex gap-2">
            <button class="btn btn-outline-primary" id="filterActifs">Actifs</button>
            <button class="btn btn-outline-secondary" id="filterTous">Tous</button>
        </div>

    </div>

    <!-- Boutons à droite -->
    <div class="d-flex gap-2">
        <a href="{% url 'paie:client_liste_mois' %}" class="btn btn-primary">
            Mois de paie
        </a>

        <a href="{% url 'paie:paie_client_dashboard' %}" class="btn btn-outline-secondary">
            Retour au dashboard
        </a>
    </div>

</div>


{% if salaries %}
<table class="table table-hover align-middle">
    <thead>
        <tr>
            <th>Nom</th>
            <th>Date de naissance</th>
            <th>N° Sécurité sociale</th>
            <th>Mutuelle</th>
            <th>Salaire de base</th>
            <th>Date entrée</th>
            <th>Date sortie</th>
            <th>Actif</th>
        </tr>
    </thead>

    <tbody>
        {% for s in salaries %}
        <tr>
            <td>{{ s.prenom }} {{ s.nom }}</td>
            <td>{{ s.date_naissance|date:"d/m/Y" }}</td>
            <td>{{ s.numero_securite_sociale }}</td>
            <td>{{ s.mutuelle|default:"-" }}</td>
            <td>{{ s.salaire_base }} €</td>
            <td>{{ s.date_entree|date:"d/m/Y" }}</td>
            <td>{{ s.date_sortie|date:"d/m/Y"|default:"-" }}</td>
            <td>
                {% if s.actif %}
                    <span class="badge bg-success">Actif</span>
                {% else %}
                    <span class="badge bg-secondary">Inactif</span>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% else %}
    <p class="text-muted">Aucun salarié trouvé.</p>
{% endif %}
<script>
document.addEventListener("DOMContentLoaded", function () {

    const searchInput = document.getElementById("searchInput");
    const filterActifsBtn = document.getElementById("filterActifs");
    const filterTousBtn = document.getElementById("filterTous");
    const rows = document.querySelectorAll("table tbody tr");

    // --- FILTRE PAR NOM ---
    searchInput.addEventListener("keyup", function () {
        const query = this.value.toLowerCase();

        rows.forEach(row => {
            const nom = row.querySelector("td").innerText.toLowerCase();
            row.style.display = nom.includes(query) ? "" : "none";
        });
    });

    // --- FILTRE ACTIFS ---
    filterActifsBtn.addEventListener("click", function () {
        rows.forEach(row => {
            const actifBadge = row.querySelector("td:last-child .badge");
            const isActif = actifBadge && actifBadge.classList.contains("bg-success");
            row.style.display = isActif ? "" : "none";
        });
    });

    // --- FILTRE TOUS ---
    filterTousBtn.addEventListener("click", function () {
        rows.forEach(row => row.style.display = "");
        searchInput.value = "";
    });

});
</script>

{% endblock %}
